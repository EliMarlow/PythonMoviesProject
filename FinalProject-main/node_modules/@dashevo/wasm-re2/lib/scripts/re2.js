"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("events");const t=(e,t)=>{if(null==e)throw TypeError(`${t} ${null===e?null:typeof e}.`)},r=(e,...t)=>t.forEach(e._free),n=(e,...t)=>t.map((e=>t=>{const r=t.length+1,n=e._malloc(r);return e.stringToUTF8(t,n,r),n})(e)),s="0123456789ABCDEF",i=e=>-1!==s.indexOf(e.toUpperCase()),o=require("../../bin/re2Lib"),u=new e.EventEmitter;let c,a=!1;class p{constructor(e,o=""){this.numberOfCaptureGroups=()=>{const[e]=n(c,this.regex),t=c._getQtyOfCapturingGroups(e);return r(c,e),t},this.test=e=>this.re2.testRegex(e),this.exec=e=>this.re2.execRegex(e),this.replace=(e,t)=>this.re2.replaceString({string:e,rewrite:t}),e=e.replace(/(^|[^\\])((?:\\\\)*)\//g,"$1$2\\/"),((e,s)=>{t(s,"Regular expression can not be");const[i]=n(e,s),o=e._validate(i),u=e.UTF8ToString(o);if(r(e,i,o),u)throw u})(c,e),this.regex=e,this.re2=((e,s,i)=>({testRegex:i=>{t(i,"Input text can not be");const o=""+i,[u,c]=n(e,o,s),a=!!e._check(u,c);return r(e,u,c),a},execRegex:o=>{t(o,"Input text can not be");const u=""+o,[c,a,p]=n(e,u,s,i),h=e._getQtyOfCapturingGroups(a)+1;if(h<0)throw Error("Error with groups");if(0===h)return null;const l=e._exec(c,a,p);if(0===l)return null;const f=e._getQtyOfMatchedGroups(c,a,p),g=((e,t,r,n)=>{const s=[];for(let i=0;i<r;i+=1){const r=[];for(let s=0;s<n;s+=1){const n=e._getStringPtrFromMatrix(t,i,s),o=e.UTF8ToString(n);r.push(o)}s.push(r)}return s})(e,l,f,h);return r(e,c,a,l,p),g},replaceString:({string:o,rewrite:u})=>{t(o,"Input text can not be"),t(u,"Replacement string can not be");const c=""+o,a=""+u,[p,h,l,f]=n(e,c,s,a,i),g=e._replace(p,h,l,f),x=e.UTF8ToString(g);return r(e,p,h,l,f,g),x}}))(c,((e,t)=>{const r=[];if(""===e)return"(?:)";t&&r.push("(?m)");for(let t=0;t<e.length;){if("\\"===e[t]){if(t+1<e.length){switch(e[t+1]){case"\\":r.push("\\\\"),t+=2;break;case"c":if(t+2<e.length){const n="ABCDEFGHIJKLMNOPQRSTUVWXYZ".indexOf(e[t+2])+1;if(n>=0){r.push("\\x",s[Math.floor(n/16)],s[n%16]),t+=3;break}}r.push("\\c"),t+=2;break;case"u":if(t+2<e.length){const n=e[t+2];if(i(n)){r.push("\\x{"),r.push(n),t+=3;for(let n=0;n<3&&t<e.length&&i(e[t]);t++,n++)r.push(e[t]);r.push("}");break}if("{"===n){r.push("\\x"),t+=2;break}}r.push("\\u"),t+=2;break;default:r.push("\\",e[t+1]),t+=2}continue}}else{if("/"===e[t]){r.push("\\/"),t+=1;continue}if("(?<"===e.substring(t,t+3)&&"="!==e[t+3]&&"!"!==e[t+3]){r.push("(?P<"),t+=3;continue}}r.push(e[t]),t+=1}return r.join("")})(e,"m"===o),o)}}exports.RE2=p,exports.getRE2Class=async function(){return c||await new Promise(e=>{a?u.once("LOADED",()=>{e()}):async function(){a=!0,c=await o(),a=!1,u.emit("LOADED")}().then(()=>{e()})}),p};
//# sourceMappingURL=re2.js.map
